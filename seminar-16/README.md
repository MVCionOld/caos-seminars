# Семинар №16
## fcntl, dup*, pipe, fifo

---

### fcntl

Системный вызов `fcntl` позволяет настраивать различные манипуляции над открытыми файловыми дескрипторами.

```shell
SYNOPSIS
     #include <fcntl.h>

     int
     fcntl(int fildes, int cmd, ...);
```
  
Какие команды можно передавать в `fcntl` (см. `man`):
 * `F_DUPFD` - команда создания файлового дескриптора-копии на объект
 * `F_DUPFD_CLOEXEC` - аналогично `F_DUPFD` + закрывает созданные файловые дескрипторы при вызове `exec`
 * `F_GETFD` - получить флаги ассоциированные с файловым дескриптором
 * `F_SETFD` - установить флаги ассоциированные с файловым дескриптором
 * ... 

---

### Семейство dup*

 `dup`, `dup2`, `dup3` - позволяют "скопировать" файловый дескриптор. То есть получить еще один файловый дескриптор на тот 
 же файл/соединение. Например, так можно скопировать дескриптор файла в `1` файловый дескриптор (`stdout`) и потом с помощью функции `printf` писать в этот файл.
 * `dup` - делает какую-то копию, возвращает ее в качестве значения - `fildes2 = dup(fildes)`
 * `dup2` - делает копию туда, куда вы хотите
    * если `fildes == fildes2`, то возвращает `fildes2`
    * если `fildes2` уже ассоциирован с каким-то файлом, то сперва дескриптор закрывает посредством `close`
 * `dup3` - делает копию туда, куда вы хотите + c указанными опциями
    * если `fildes == fildes2`, то падает с `EINVAL`

---

### pipe

`pipe` - позволяет создать трубу(=pipe) - получить пару файловых дескрипторов. 
В один из них можно что-то писать, при этом оно будет становиться доступным для чтения из другого дескриптора. Можно 
рассматривать `pipe` как своеобразный файл-очередь.  

 * `pipe` - делает трубу
 * `pipe2` - делает трубу c указанными опциями

**Важно**: вместимость пайпа ограничена, но в нормальном режиме его работы consumer и producer работают одновременно, и 
поэтому ограниченная вместимость ничего не портит - если что producer подождет, пока consumer что-нибудь вычитает 
(аналогично тому как consumer ждет, пока producer что-нибудь напишет, если данных в пайпе нет).

Про [чтение](https://github.com/victor-yacovlev/mipt-diht-caos/tree/master/practice/fdup-pipe#%D1%87%D1%82%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B8%D0%B7-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB%D0%B0) и [запись](https://github.com/victor-yacovlev/mipt-diht-caos/tree/master/practice/fdup-pipe#%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B2-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB) в pipe можно также почитать в общем ридинге.

---
